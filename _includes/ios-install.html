<!-- Unified iOS & Android PWA Prompt -->
<div id="install-prompt" style="display: none; position: fixed; bottom: 20px; left: 10px; right: 10px; padding: 16px; background: #fdf6e3; border: 1px solid #e0e0e0; border-radius: 10px; font-family: 'Fira Sans', sans-serif; color: #333; text-align: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 9999;">
  <button onclick="hidePrompt()" style="position: absolute; top: 4px; right: 8px; background: none; border: none; font-size: 18px; cursor: pointer;">Ã—</button>
  <div id="ios-message" style="display: none;">
    <strong>Install this app:</strong><br>
    Tap <span style="font-size: 18px;">ðŸ”—</span> then <strong>Add to Home Screen</strong>
  </div>
  <div id="android-message" style="display: none;">
    <strong>Install this app for quick access:</strong><br>
    <button id="install-btn" style="margin-top: 8px; padding: 6px 12px; font-weight: 600; background: #333; color: white; border: none; border-radius: 5px;">Install</button>
  </div>
</div>

<script>
  const promptDelayDays = 3;

  function hidePrompt() {
    document.getElementById('install-prompt').style.display = 'none';
    localStorage.setItem('pwaPromptDismissedAt', Date.now().toString());
  }

  function shouldShowPrompt() {
    const dismissedAt = localStorage.getItem('pwaPromptDismissedAt');
    if (!dismissedAt) return true;
    const daysSince = (Date.now() - parseInt(dismissedAt)) / (1000 * 60 * 60 * 24);
    return daysSince >= promptDelayDays;
  }

  const isIOS = () => /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
  const isInStandaloneMode = () => ('standalone' in window.navigator) && window.navigator.standalone;

  // Android logic
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    if (!shouldShowPrompt()) return;

    e.preventDefault();
    deferredPrompt = e;

    document.addEventListener('DOMContentLoaded', () => {
      const promptEl = document.getElementById('install-prompt');
      const androidMsg = document.getElementById('android-message');
      if (promptEl && androidMsg) {
        promptEl.style.display = 'block';
        androidMsg.style.display = 'block';

        document.getElementById('install-btn').addEventListener('click', async () => {
          promptEl.style.display = 'none';
          localStorage.setItem('pwaPromptDismissedAt', Date.now().toString());
          deferredPrompt.prompt();
          const choiceResult = await deferredPrompt.userChoice;
          console.log('User choice:', choiceResult.outcome);
          deferredPrompt = null;
        });

        setTimeout(hidePrompt, 15000); // auto-close after 15 sec
      }
    });
  });

  // iOS logic
  if (isIOS() && !isInStandaloneMode() && shouldShowPrompt()) {
    document.addEventListener('DOMContentLoaded', () => {
      const promptEl = document.getElementById('install-prompt');
      const iosMsg = document.getElementById('ios-message');
      if (promptEl && iosMsg) {
        promptEl.style.display = 'block';
        iosMsg.style.display = 'block';
        setTimeout(hidePrompt, 15000);
      }
    });
  }
</script>
